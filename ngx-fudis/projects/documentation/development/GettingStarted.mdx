import { Meta } from "@storybook/blocks";
import * as VersionSelectorStories from "../../ngx-fudis/src/lib/components/version-selector/version-selector.stories";

<Meta title="Documentation/Development/Getting Started" />

# Getting Started with Development Environment

Setting up your local development environment according to these instructions is highly recommended for a smooth and uniform development experience accross the team (and 3rd parties, too).

**Table of Contents**

1. [Requirements](#requirements)
2. [Set Up Local Repository](#set-up-local-repository)
3. [Install Dependencies](#install-dependencies)
4. [Development](#development)
5. [Testing](#testing)
6. [Sandbox Application](#sandbox-application)
7. [Format and Lint](#format-and-lint)
8. [Additional Command Reference](#additional-command-reference)

## Requirements

- MacOS or Linux
- Git
- Docker
  - Any fairly recent version should work. Originally developed with Docker Engine v24.
- Node.js and NPM
  - For just running Storybook locally, any version will do as the containers will internally use correct versions anyway. If you plan to do anything else, using the version specified in `.nvmrc` is highly recommended (`v24.12.0` at the time of writing this doc).
  - In general, using [NVM](https://github.com/nvm-sh/nvm) and setting your terminal to automatically switch Node.js versions based on `.nvmrc` files is highly recommended.
- IDE with robust support for TypeScript
  - We prefer VS Code and offer a settings template to get going immediately (see [VS Code Setup Instructions](/docs/documentation-development-tooling-setup-vs-code--documentation)).

## Set Up Local Repository

Clone the upstream repository to your machine (requires write access).

```
git clone git@github.com:funidata/fudis.git
```

If you do not have write access and you are not working for Funidata, you need to first fork our repository to your own account and use that for development.

## Install Dependencies

To install project dependencies, in the **root** directory run:

```
npm ci
```

**Note!** This does not install Playwright locally. If your OS is supported by Playwright and want to run Playwright with their UI tool run:

```
cd test && npm ci && cd ..
```

## Development

The development is done in Storybook environment. You can read more about Storybook from the [official Storybook site](https://storybook.js.org/).

The development is done in the Storybook environment. Fudis uses webpack middleware for bundling JavaScript. You can read more about Storybook from the [official Storybook site](https://storybook.js.org/).

In the **root** directory run:

```
npm start
```

After starting, the terminal is attached to log output. You can detach (CTRL+C) from the logs and the application will keep running in the background.

Once you are done, shutdown the development environment:

```
npm stop
```

You can use `docker ps` to verify all containers are down (and to check their status if something is not working).

### View Logs

Attaches terminal to Docker's interactive log output. Use this to see the logs again after detaching.

```
npm run logs
```

## Testing

Run these commands in the **root** directory.

### Component Tests

```
npm test
```

Filenames (full or partial) can be appended to this command with NPM's "`--`" syntax to run tests for matching files only, e.g. `npm test -- badge`.

### Visual Regression Tests

```
npm run test:vr
```

Filenames (full or partial) can be appended to this command as well, e.g. `npm run test:vr -- badge`.

### Launch Playwright UI

Opens in a new Chromium instance.

```
npm run test:ui
```

## Sandbox Application

Start the sandbox application with hot-reload by running the following command in the **root** directory. Access at [http://localhost:4200](http://localhost:4200).

```
npm run start:sandbox
```

## Format and Lint

Run these commands in the **root** directory.

### ESLint

Lints `.js`, `.ts` and `.html` files

```
npm run lint
```

### Lint

Lint styles

```
npm run stylelint
```

### Format

Format code

```
npm run format
```

Check formatting

```
npm run format:check
```

## Additional Command Reference

### Build Fudis

To build the distributable package, in **ngx-fudis** folder run:

```
npm run build:ngx-fudis
```

This creates a **dist** folder under the **ngx-fudis** directory.

### Start Storybook Without Container

In **ngx-fudis** folder run:

```
npm run storybook
```
